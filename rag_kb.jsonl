{"snippet_name": "Route 53 Query Log Configuration", "keywords": ["aws_route53_zone", "route53-query-logging-policy", "log_stream", "put_log_events", "terraform", "cloudwatch_log_group"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\nprovider \"aws\" {\n  region  = \"us-east-1\"\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\n\nresource \"aws_route53_zone\" \"primary\" {\n  name = \"example53.com\"\n}\n\nresource \"aws_cloudwatch_log_group\" \"aws_route53_example_com\" {\n  name              = \"/aws/route53/${aws_route53_zone.primary.name}\"\n  retention_in_days = 30\n}\n\n# Example CloudWatch log resource policy to allow Route53 to write logs\n# to any log group under /aws/route53/*\n\ndata \"aws_iam_policy_document\" \"route53-query-logging-policy\" {\n  statement {\n    actions = [\n      \"logs:CreateLogStream\",\n      \"logs:PutLogEvents\",\n    ]\n\n    resources = [\"arn:aws:logs:*:*:log-group:/aws/route53/*\"]\n\n    principals {\n      identifiers = [\"route53.amazonaws.com\"]\n      type        = \"Service\"\n    }\n  }\n}\n\nresource \"aws_cloudwatch_log_resource_policy\" \"route53-query-logging-policy\" {\n  policy_document = data.aws_iam_policy_document.route53-query-logging-policy.json\n  policy_name     = \"route53-query-logging-policy\"\n}\n\nresource \"aws_route53_query_log\" \"example_com\" {\n  depends_on = [aws_cloudwatch_log_resource_policy.route53-query-logging-policy]\n\n  cloudwatch_log_group_arn = aws_cloudwatch_log_group.aws_route53_example_com.arn\n  zone_id                  = aws_route53_zone.primary.zone_id\n}", "original_prompt": "Configure a query log that can create a log stream and put log events using Route 53 resources. Name the zone \"primary\", the cloudwatch log group \"aws_route53_example_com\", and the cloudwatch log resource policy \"route53-query-logging-policy\""}
{"snippet_name": "AWS VPC & Route 53 Zone Association Setup", "keywords": ["aws", "vpc", "route53_zone", "authorization", "association", "terraform"], "iac_code": "provider \"aws\" {\n    region = \"us-east-1\"\n}\n\nresource \"aws_vpc\" \"example\" {\n  cidr_block           = \"10.6.0.0/16\"\n  enable_dns_hostnames = true\n  enable_dns_support   = true\n}\n\nresource \"aws_route53_zone\" \"example\" {\n  name = \"example.com\"\n\n  vpc {\n    vpc_id = aws_vpc.example.id\n  }\n}\n\nresource \"aws_vpc\" \"alternate\" {\n  cidr_block           = \"10.7.0.0/16\"\n  enable_dns_hostnames = true\n  enable_dns_support   = true\n}\n\nresource \"aws_route53_vpc_association_authorization\" \"example\" {\n  vpc_id  = aws_vpc.alternate.id\n  zone_id = aws_route53_zone.example.id\n}\n\nresource \"aws_route53_zone_association\" \"example\" {\n  vpc_id  = aws_route53_vpc_association_authorization.example.vpc_id\n  zone_id = aws_route53_vpc_association_authorization.example.zone_id\n}", "original_prompt": "Configure a valid Route 53 zone association resource"}
{"snippet_name": "Route 53 Record Linked to Elastic Load Balancer Configuration", "keywords": ["aws_route53_zone", "domain_name", "route53_record", "aws_elb", "elastic_load_balancer", "terraform"], "iac_code": "provider \"aws\" {\n  region = \"us-east-1\"\n}\n\nresource \"aws_route53_zone\" \"primary\" {\n  name = \"example53.com\"\n}\n\nresource \"aws_elb\" \"main\" {\n  name               = \"sample\"\n  availability_zones = [\"us-east-1c\"]\n\n  listener {\n    instance_port     = 80\n    instance_protocol = \"http\"\n    lb_port           = 80\n    lb_protocol       = \"http\"\n  }\n}\n\nresource \"aws_route53_record\" \"www\" {\n  zone_id = aws_route53_zone.primary.zone_id\n  name    = \"example53.com\"\n  type    = \"A\"\n\n  alias {\n    name                   = aws_elb.main.dns_name\n    zone_id                = aws_elb.main.zone_id\n    evaluate_target_health = true\n  }\n}", "original_prompt": "Configure a Route 53 record with an Elastic Load Balancer resource. Call the zone \"primary\" and the elb \"main\""}
{"snippet_name": "Multi-Region Database Replication with Weighted Routing via AWS RDS and Route 53", "keywords": ["aws_route53_zone", "aws_db_instance", "weighted_routing_policy", "aws_route53_record"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n      configuration_aliases = [ aws.main, aws.us_east, aws.eu_central, aws.ap_southeast ]\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\n\nprovider \"aws\" {\n  alias = \"main\"\n  region = \"us-west-2\" \n\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"us_east\"\n  region = \"us-east-1\" # Example region for US East\n\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"eu_central\"\n  region = \"eu-central-1\" # Example region for EU Central\n\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\nprovider \"aws\" {\n  alias  = \"ap_southeast\"\n  region = \"ap-southeast-1\" # Example region for AP Southeast\n\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\nresource \"aws_db_instance\" \"primary\" {\n  provider = aws.main\n  identifier = \"master\"\n  allocated_storage    = 20\n  engine               = \"postgres\"\n  instance_class       = \"db.t3.micro\"\n  username             = \"dbadmin\"\n  password             = \"your_password_here\"\n  skip_final_snapshot  = true\n  backup_retention_period  = 7\n}\n\nresource \"aws_db_instance\" \"replica_us_east\" {\n  provider             = aws.us_east\n  replicate_source_db  = aws_db_instance.primary.arn\n  instance_class       = \"db.t3.micro\"\n  identifier           = \"mydb-replica-us-east\"\n  skip_final_snapshot  = true\n}\n\nresource \"aws_db_instance\" \"replica_eu_central\" {\n  provider             = aws.eu_central\n  replicate_source_db  = aws_db_instance.primary.arn\n  instance_class       = \"db.t3.micro\"\n  identifier           = \"mydb-replica-eu-central\"\n  skip_final_snapshot  = true\n}\n\nresource \"aws_db_instance\" \"replica_ap_southeast\" {\n  provider             = aws.ap_southeast\n  replicate_source_db  = aws_db_instance.primary.arn\n  \n  instance_class       = \"db.t3.micro\"\n  identifier           = \"mydb-replica-ap-southeast\"\n  skip_final_snapshot  = true\n}\n\n# Route53 Hosted Zone\nresource \"aws_route53_zone\" \"main\" {\n  provider = aws.main\n  name = \"example53.com\"\n}\n\n\n# Route53 Records for each RDS Read Replica with a Weighted Routing Policy\nresource \"aws_route53_record\" \"replica_us_east_cname\" {\n  provider = aws.main\n\n  zone_id = aws_route53_zone.main.zone_id\n  name    = \"us.east.example53.com\"\n  type    = \"CNAME\"\n  records = [aws_db_instance.replica_us_east.endpoint]\n  ttl     = \"60\"\n  weighted_routing_policy {\n    weight = 30\n  }\n  set_identifier = \"replica-us-east\"\n}\n\nresource \"aws_route53_record\" \"replica_eu_central_cname\" {\n  provider = aws.main\n\n  zone_id = aws_route53_zone.main.zone_id\n  name    = \"eu.central.example53.com\"\n  type    = \"CNAME\"\n  records = [aws_db_instance.replica_eu_central.endpoint]\n  ttl     = \"60\"\n  weighted_routing_policy {\n    weight = 30\n  }\n  set_identifier = \"replica-eu-central\"\n}\n\nresource \"aws_route53_record\" \"replica_ap_southeast_cname\" {\n  provider = aws.main\n\n  zone_id = aws_route53_zone.main.zone_id\n  name    = \"ap.southeast.example53.com\"\n  type    = \"CNAME\"\n  records = [aws_db_instance.replica_ap_southeast.endpoint]\n  ttl     = \"60\"\n  weighted_routing_policy {\n    weight = 30\n  }\n  set_identifier = \"replica-ap-southeast\"\n}", "original_prompt": "Using route 53 resources, configure a weighted routing policy that splits users between three db_instances that are replicas of a main db_instance. Provision the three replica instances in \"us-east-1\", \"eu-central-1\", and \"ap-southeast-1\". Provision the zone and main db_instance in \"us-west-1\". Call the zone \"main\", the original db_instance \"primary\", the three replicas \"replica_us_east\", \"replica_eu_central\" and \"replica_ap_southeast\" respectively, and the provider aliases \"main\", \"us-east\", \"eu-central\", and \"ap-southeast\"."}
{"snippet_name": "Configuring Different Database Endpoints via AWS VPCs & Route 53", "keywords": ["aws", "db subnet group", "rds", "vpc", "route 53", "cname record", "hosted zone", "terraform"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\n\nprovider \"aws\" {\n  region = \"us-east-1\" \n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\n# Create a VPC for internal resources\nresource \"aws_vpc\" \"main\" {\n  cidr_block = \"10.0.0.0/24\"\n}\n\n\n# RDS instances\nresource \"aws_db_instance\" \"internal\" {\n  # Internal DB configuration\n  allocated_storage    = 20\n  engine               = \"mysql\"\n  instance_class       = \"db.t3.micro\"\n  identifier =  \"internal\"\n  username             = \"user\"\n  password             = \"password\"\n  db_subnet_group_name = aws_db_subnet_group.main.name\n  skip_final_snapshot  = true\n}\n\nresource \"aws_db_instance\" \"public\" {\n  # Public DB configuration\n  publicly_accessible  = true\n  allocated_storage    = 20\n  engine               = \"mysql\"\n  instance_class       = \"db.t3.micro\"\n  identifier = \"public\"\n  username             = \"user\"\n  password             = \"password\"\n  skip_final_snapshot  = true\n}\n\nresource \"aws_db_subnet_group\" \"main\" {\n  name       = \"mydb-subnet-group\"\n  subnet_ids = [aws_subnet.maina.id, aws_subnet.mainb.id]\n}\n\ndata \"aws_availability_zones\" \"available\" {}\n\n# Subnet for RDS\nresource \"aws_subnet\" \"maina\" {\n  vpc_id            = aws_vpc.main.id\n  cidr_block        = \"10.0.0.0/25\"\n  availability_zone = data.aws_availability_zones.available.names[0]\n}\n\nresource \"aws_subnet\" \"mainb\" {\n  vpc_id            = aws_vpc.main.id\n  cidr_block        = \"10.0.0.128/25\"\n  availability_zone = data.aws_availability_zones.available.names[1]\n}\n\n# Route 53 Public Hosted Zone for external users\nresource \"aws_route53_zone\" \"public\" {\n  name = \"example53.com\"\n}\n\n# Route 53 Private Hosted Zone for internal users\nresource \"aws_route53_zone\" \"private\" {\n  name = \"example53.com\"\n  vpc {\n    vpc_id = aws_vpc.main.id\n  }\n}\n\n# Route 53 Record for Public DB (External Endpoint)\nresource \"aws_route53_record\" \"public_db\" {\n  zone_id = aws_route53_zone.public.zone_id\n  name    = \"public-db.example.com\"\n  type    = \"CNAME\"\n  ttl     = \"300\"\n  records = [aws_db_instance.public.address]\n}\n\n# Route 53 Record for Internal DB (Internal Endpoint)\nresource \"aws_route53_record\" \"internal_db\" {\n  zone_id = aws_route53_zone.private.zone_id\n  name    = \"internal-db.example.com\"\n  type    = \"CNAME\"\n  ttl     = \"300\"\n  records = [aws_db_instance.internal.address]\n}", "original_prompt": "Configure Route 53 to return different database endpoints to internal versus external users. Internal users are routed to an internal RDS instance, while external users are routed to a publicly accessible one. Name the zones \"private\" and \"public\", the databases \"internal\" and \"public\", and the subnet group \"main\""}
{"snippet_name": "AWS Database Replicas Routing Configuration\n\nThe IaC code sets up three AWS resources: `aws_db_instance` for the primary and two replicas of the database, and `aws_route53_zone` to create a Route 53 hosted zone. It then creates two `aws_route53_record` resources with CNAME records that point to each replica's endpoint URL. The weighted routing policy is applied to these records, allowing traffic to be split between the replicas based on their assigned weights.", "keywords": ["weighted_routing_policy", "aws_db_instance", "route53_zone", "rds_replica", "terraform"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\nprovider \"aws\" {\n  region  = \"us-east-1\"\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\n\nresource \"aws_db_instance\" \"primary\" {\n  identifier = \"primary\"\n  allocated_storage    = 20\n  engine               = \"postgres\"\n  instance_class       = \"db.t3.micro\"\n  username             = \"dbadmin\"\n  password             = \"your_password_here\"\n  skip_final_snapshot  = true\n  backup_retention_period  = 7\n}\n\nresource \"aws_db_instance\" \"replica_1\" {\n  replicate_source_db  = aws_db_instance.primary.identifier\n  instance_class       = \"db.t3.micro\"\n  identifier           = \"mydb-replica-1\"\n  skip_final_snapshot  = true\n}\n\nresource \"aws_db_instance\" \"replica_2\" {\n  replicate_source_db  = aws_db_instance.primary.identifier\n  instance_class       = \"db.t3.micro\"\n  identifier           = \"mydb-replica-2\"\n  skip_final_snapshot  = true\n}\n\n\n# Route53 Hosted Zone\nresource \"aws_route53_zone\" \"main\" {\n  name = \"example53.com\"\n}\n\n\n# Route53 Records for each RDS Read Replica with a Weighted Routing Policy\nresource \"aws_route53_record\" \"replica_1_cname\" {\n  zone_id = aws_route53_zone.main.zone_id\n  name    = \"replica1.example53.com\"\n  type    = \"CNAME\"\n  records = [aws_db_instance.replica_1.endpoint]\n  ttl     = \"60\"\n  weighted_routing_policy {\n    weight = 10\n  }\n  set_identifier = \"replica-1-record\"\n}\n\nresource \"aws_route53_record\" \"replica_2_cname\" {\n  zone_id = aws_route53_zone.main.zone_id\n  name    = \"replica2.example53.com\"\n  type    = \"CNAME\"\n  records = [aws_db_instance.replica_2.endpoint]\n  ttl     = \"60\"\n  weighted_routing_policy {\n    weight = 20\n  }\n  set_identifier = \"replica-2-record\"\n}", "original_prompt": "Using route 53 resources, configure a weighted routing policy that splits users between two db_instances that are replicas of a main db_instance. Call the zone \"main\", the original db_instance \"primary\", and the two replicas \"replica-1\" and \"replica-2\" respectively"}
{"snippet_name": "AWS Elastic Beanstalk Environment Setup", "keywords": ["aws", "elasticbeanstalk", "instance profile", "environment", "iam role", "terraform", "application"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\nprovider \"aws\" {\n  region  = \"us-east-1\"\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\n\n# IAM role for Elastic Beanstalk EC2 instances\nresource \"aws_iam_role\" \"eb_ec2_role\" {\n  name = \"elastic_beanstalk_ec2_role_eb1\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\",\n    Statement = [\n      {\n        Action = \"sts:AssumeRole\",\n        Effect = \"Allow\",\n        Principal = {\n          Service = \"ec2.amazonaws.com\"\n        },\n      },\n    ]\n  })\n}\n\n# Attach the AWS managed policy for Elastic Beanstalk to the role\nresource \"aws_iam_role_policy_attachment\" \"eb_managed_policy\" {\n  role       = aws_iam_role.eb_ec2_role.name\n  policy_arn = \"arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier\"\n}\n\n\n# Create an instance profile tied to the role\nresource \"aws_iam_instance_profile\" \"eb_ec2_profile\" {\n  name = \"elastic_beanstalk_ec2_profile\"\n  role = aws_iam_role.eb_ec2_role.name\n}\n\n# Elastic Beanstalk Application\nresource \"aws_elastic_beanstalk_application\" \"my_application\" {\n  name        = \"my-three-tier-app\"\n}\n\n# Elastic Beanstalk Environment for the web tier\nresource \"aws_elastic_beanstalk_environment\" \"web_tier\" {\n  name                = \"my-web-tier-env\"\n  application         = aws_elastic_beanstalk_application.my_application.name\n  solution_stack_name = \"64bit Amazon Linux 2023 v4.3.0 running Python 3.9\"\n\n  setting {\n    namespace = \"aws:autoscaling:launchconfiguration\"\n    name      = \"IamInstanceProfile\"\n    value     = aws_iam_instance_profile.eb_ec2_profile.name\n  } \n}", "original_prompt": "Create a basic elastic beanstalk environment with a elastic beanstalk application. Name the iam_role \"eb_ec2_role\", the instance profile \"eb_ec2_profile\", and the elastic beanstalk application \"my_application\""}
{"snippet_name": "AWS Elastic Beanstalk Environment with Autoscaling Configuration\n\nThe code creates an IAM role named \"eb_ec2_role\" that allows EC2 instances to assume the role. It then attaches a policy allowing access to AWS services required by Elastic Beanstalk. An instance profile is created and tied to this role, which will be used by EC2 instances running in the environment.\n\nAn Elastic Beanstalk application named \"my_api_app\" is defined, followed by an Elastic Beanstalk environment called \"MyApiEnvironment\". This environment uses a specific solution stack for Python applications and sets up autoscaling triggers based on CPU utilization. The settings define thresholds for scaling actions (increasing or decreasing instances), minimum and maximum instance sizes, and the use of the previously created IAM role through an IamInstanceProfile.", "keywords": ["iam_role", "aws", "elastic_beanstalk_environment", "instance_profile", "terraform", "autoscaling"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\nprovider \"aws\" {\n  region  = \"us-east-1\"\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\nresource \"aws_iam_role\" \"eb_ec2_role\" {\n  name = \"elastic_beanstalk_ec2_role_eb1\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\",\n    Statement = [\n      {\n        Action = \"sts:AssumeRole\",\n        Effect = \"Allow\",\n        Principal = {\n          Service = \"ec2.amazonaws.com\"\n        },\n      },\n    ]\n  })\n}\n\n# Attach the AWS managed policy for Elastic Beanstalk to the role\nresource \"aws_iam_role_policy_attachment\" \"eb_managed_policy\" {\n  role       = aws_iam_role.eb_ec2_role.name\n  policy_arn = \"arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier\"\n}\n\n\n# Create an instance profile tied to the role\nresource \"aws_iam_instance_profile\" \"eb_ec2_profile\" {\n  name = \"elastic_beanstalk_ec2_profile\"\n  role = aws_iam_role.eb_ec2_role.name\n}\n\n\nresource \"aws_elastic_beanstalk_application\" \"my_api_app\" {\n  name        = \"MyAPIApplication\"\n}\n\nresource \"aws_elastic_beanstalk_environment\" \"my_api_env\" {\n  name                = \"MyApiEnvironment\"\n  application         = aws_elastic_beanstalk_application.my_api_app.name\n  solution_stack_name = \"64bit Amazon Linux 2023 v4.3.0 running Python 3.9\"\n\n  # Configure scaling triggers based on CPU usage\n  setting {\n    namespace = \"aws:autoscaling:trigger\"\n    name      = \"MeasureName\"\n    value     = \"CPUUtilization\"\n  }\n\n  setting {\n    namespace = \"aws:autoscaling:trigger\"\n    name      = \"Statistic\"\n    value     = \"Average\"\n  }\n\n  setting {\n    namespace = \"aws:autoscaling:trigger\"\n    name      = \"Unit\"\n    value     = \"Percent\"\n  }\n\n  setting {\n    namespace = \"aws:autoscaling:trigger\"\n    name      = \"UpperThreshold\"\n    value     = \"75\"  \n  }\n\n  setting {\n    namespace = \"aws:autoscaling:trigger\"\n    name      = \"LowerThreshold\"\n    value     = \"25\"  \n  }\n\n  setting {\n    namespace = \"aws:autoscaling:asg\"\n    name      = \"MinSize\"\n    value     = \"1\"   \n  }\n\n  setting {\n    namespace = \"aws:autoscaling:asg\"\n    name      = \"MaxSize\"\n    value     = \"5\"    \n  }\n\n  setting {\n      namespace = \"aws:autoscaling:launchconfiguration\"\n      name      = \"IamInstanceProfile\"\n      value     = aws_iam_instance_profile.eb_ec2_profile.name\n    }\n\n}", "original_prompt": "Create an elastic beanstalk environment that contains autoscaling settings using thresholds and CPU utilization. Name the iam_role \"eb_ec2_role\", the instance profile \"eb_ec2_profile\", and the elastic beanstalk application \"my_api_app\"."}
{"snippet_name": "AWS Elastic Beanstalk Environments Configuration\n\nThe configuration includes setting up an IAM role named \"eb_ec2_role\", creating an instance profile tied to this role called \"eb_ec2_profile\", defining a common Elastic Beanstalk application named \"microservices-app\", and then creating two environments (\"microservice-one_env\" and \"microservice-two_env\") that use the same application.", "keywords": ["iam_role", "aws", "elastic_beanstalk_environment", "instance_profile", "terraform", "application"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\nprovider \"aws\" {\n  region  = \"us-east-1\"\n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\nresource \"aws_iam_role\" \"eb_ec2_role\" {\n  name = \"elastic_beanstalk_ec2_role\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\",\n    Statement = [\n      {\n        Action = \"sts:AssumeRole\",\n        Effect = \"Allow\",\n        Principal = {\n          Service = \"ec2.amazonaws.com\"\n        },\n      },\n    ]\n  })\n}\n\n# Attach the AWS managed policy for Elastic Beanstalk to the role\nresource \"aws_iam_role_policy_attachment\" \"eb_managed_policy\" {\n  role       = aws_iam_role.eb_ec2_role.name\n  policy_arn = \"arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier\"\n}\n\n\n# Create an instance profile tied to the role\nresource \"aws_iam_instance_profile\" \"eb_ec2_profile\" {\n  name = \"elastic_beanstalk_ec2_profile\"\n  role = aws_iam_role.eb_ec2_role.name\n}\n\n\n# Common Elastic Beanstalk application for all microservices\nresource \"aws_elastic_beanstalk_application\" \"microservices_app\" {\n  name        = \"microservices-app\"\n}\n\n# First microservice environment\nresource \"aws_elastic_beanstalk_environment\" \"microservice_one_env\" {\n  name                = \"microservice-one\"\n  application         = aws_elastic_beanstalk_application.microservices_app.name\n  solution_stack_name = \"64bit Amazon Linux 2023 v4.3.0 running Python 3.9\"\n\n  setting {\n    namespace = \"aws:autoscaling:asg\"\n    name      = \"MinSize\"\n    value     = \"1\"\n  }\n\n  setting {\n    namespace = \"aws:autoscaling:asg\"\n    name      = \"MaxSize\"\n    value     = \"3\"\n  }\n\n  setting {\n      namespace = \"aws:autoscaling:launchconfiguration\"\n      name      = \"IamInstanceProfile\"\n      value     = aws_iam_instance_profile.eb_ec2_profile.name\n  }\n}\n\n# Second microservice environment\nresource \"aws_elastic_beanstalk_environment\" \"microservice_two_env\" {\n  name                = \"microservice-two\"\n  application         = aws_elastic_beanstalk_application.microservices_app.name\n  solution_stack_name = \"64bit Amazon Linux 2023 v4.3.0 running Python 3.9\"\n\n  setting {\n    namespace = \"aws:autoscaling:asg\"\n    name      = \"MinSize\"\n    value     = \"2\"\n  }\n\n  setting {\n    namespace = \"aws:autoscaling:asg\"\n    name      = \"MaxSize\"\n    value     = \"4\"\n  }\n\n  setting {\n    namespace = \"aws:autoscaling:launchconfiguration\"\n    name      = \"IamInstanceProfile\"\n    value     = aws_iam_instance_profile.eb_ec2_profile.name\n  }\n}", "original_prompt": "Create two elastic beanstalk environments that use the same elastic beanstalk application. Name the iam_role \"eb_ec2_role\", the instance profile \"eb_ec2_profile\", and the elastic beanstalk application \"my_application\""}
{"snippet_name": "Elastic Beanstalk Worker Environment Configuration", "keywords": ["s3 bucket", "aws", "elasticbeanstalk", "instance profile", "iam role", "object", "terraform", "application version", "sqs queue"], "iac_code": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.75\"\n    }\n  }\n\n  required_version = \">= 1.0\"\n}\n\n\nprovider \"aws\" {\n  region = \"us-east-1\" \n  profile = \"admin-1\"\n\n  assume_role {\n    role_arn = \"arn:aws:iam::590184057477:role/yicun-iac\"\n  }\n}\n\n\nresource \"aws_iam_role\" \"eb_ec2_role\" {\n  name = \"elastic_beanstalk_ec2_role\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\",\n    Statement = [\n      {\n        Action = \"sts:AssumeRole\",\n        Effect = \"Allow\",\n        Principal = {\n          Service = \"ec2.amazonaws.com\"\n        },\n      },\n    ]\n  })\n}\n\n# Attach the AWS managed policy for Elastic Beanstalk to the role\nresource \"aws_iam_role_policy_attachment\" \"eb_managed_policy\" {\n  role       = aws_iam_role.eb_ec2_role.name\n  policy_arn = \"arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier\"\n}\n\n\n# Create an instance profile tied to the role\nresource \"aws_iam_instance_profile\" \"eb_ec2_profile\" {\n  name = \"elastic_beanstalk_ec2_profile\"\n  role = aws_iam_role.eb_ec2_role.name\n}\n\n\nresource \"aws_s3_bucket\" \"sample_bucket\" {\n  bucket_prefix = \"sample-\"\n}\n\nresource \"aws_s3_object\" \"examplebucket_object\" {\n  key    = \"randofile\"\n  bucket = aws_s3_bucket.sample_bucket.id\n  source = \"./supplement/app.zip\"\n}\n\n# Define the Elastic Beanstalk application\nresource \"aws_elastic_beanstalk_application\" \"batch_job_app\" {\n  name        = \"batch-job-application\"\n}\n\n# Define the Elastic Beanstalk application version\nresource \"aws_elastic_beanstalk_application_version\" \"version\" {\n  name        = \"batch-job-app-version\"\n  application = aws_elastic_beanstalk_application.batch_job_app.name\n  bucket = aws_s3_object.examplebucket_object.bucket\n  key    = aws_s3_object.examplebucket_object.key\n}\n\n# Create an Elastic Beanstalk environment in the worker tier\nresource \"aws_elastic_beanstalk_environment\" \"batch_job_env\" {\n  name                = \"batch-job-environment\"\n  application         = aws_elastic_beanstalk_application.batch_job_app.name\n  solution_stack_name = \"64bit Amazon Linux 2023 v4.3.0 running Python 3.9\"\n  tier                = \"Worker\"\n  version_label       = aws_elastic_beanstalk_application_version.version.name\n\n  setting {\n    namespace = \"aws:elasticbeanstalk:environment\"\n    name      = \"EnvironmentType\"\n    value     = \"SingleInstance\" \n  }\n\n  setting {\n    namespace = \"aws:elasticbeanstalk:sqsd\"\n    name      = \"WorkerQueueURL\"\n    value     = aws_sqs_queue.batch_job_queue.id \n  }\n\n  setting {\n    namespace = \"aws:elasticbeanstalk:sqsd\"\n    name      = \"HttpPath\"\n    value     = \"/\"\n  }\n\n  setting {\n    namespace = \"aws:elasticbeanstalk:sqsd\"\n    name      = \"MimeType\"\n    value     = \"application/json\" \n  }\n\n  setting {\n    namespace = \"aws:autoscaling:launchconfiguration\"\n    name      = \"IamInstanceProfile\"\n    value     = aws_iam_instance_profile.eb_ec2_profile.name\n  }\n}\n\n# Define the SQS queue\nresource \"aws_sqs_queue\" \"batch_job_queue\" {\n  name = \"batch-job-queue\"\n}", "original_prompt": "Create an elastic beanstalk worker environment for running batch processing jobs. Name the iam_role \"eb_ec2_role\", the instance profile \"eb_ec2_profile\", the elastic beanstalk application \"batch_job_app\", the bucket \"sampleapril26426\", the object \"examplebucket_object\", the sqs queue \"batch_job_queue\", and the application version \"version\"."}
